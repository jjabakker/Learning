---
title: "wrangle"
author: "Hans"
date: "9/7/2019"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```


# Data frame

```{r}

# stringsAsFactors=FALSE is used to prevenbt the automatic creatuiib of factors
# For 'sex' you want it, so there you specify it explicitly
mydata <- data.frame(person=c("Peter","Lois","Meg","Chris","Stewie"),
                     age=c(42,40,17,14,1),
                     sex=factor(c("M","F","F","M","M")), 
                     stringsAsFactors = FALSE)
mydata
mydata$age
mydata$sex
mydata$person
```

# Tibble

Excerpt From: Tilman M. Davies. “The Book of R”. Apple Books. 
```{r}
head(iris,15)
tib_iris <- as_tibble(iris)
```

```{r}
tibble(
  x = 1:10,
  y = 1,
  z = x^2 +y
)
```

tribble(
  ~x, ~y, ~z,
  "a", 2, 3.6,
  "b", 1, 8.5)




```{r}
tibble(
 a = lubridate::now() + runif(1e3) * 86400,
 b = lubridate::today() + runif(1e3) * 30,
 c = 1:1e3,
 d = runif(1e3),
 e = sample(letters, 1e3, replace = TRUE) )
```


```{r}
df <- tibble(
  x = runif(5),
  y = runif(5)
)

df

df$x

df[["x"]]

df[[1]]

```

Loop over the columns in  tibble

```{r}
df <- tibble(
  a = rnorm(10),
  b = rnorm(10),
  c = rnorm(10),
  d = rnorm(10)
)

# Create an empty vector to hold the data
output <- vector("double", ncol(df))

# Then loop
for ( i in seq_along(df)) {
  output[[i]]= median(df[[i]])  
}
output
```



```{r}
#install.packages('nycflights13')
library(dplyr)
library(nycflights13)

# Remove the flights that were cancelled 
not_cancelled <- flights %>% filter(!is.na(dep_delay), !is.na(arr_delay))
not_cancelled

#Get the average delay of all flights for each day
(avdelay <- not_cancelled %>% 
  group_by(year, month, day) %>% 
  summarise(mean = mean(dep_delay)))

avdelay

# ggplot(data = avdelay) +
#   geom_point(mapping = aes(x = year, y = mean))

```


# Detect outlier

```{r}
library (dslabs)

# The data set contains a big outlier
outlier_example

# You can see that because mean and median differ a lot
mean(outlier_example)
median(outlier_example)

# You can see that also because sd is large
sd(outlier_example)

# You can see that also in the histogram
qplot(outlier_example)

# You can see that also in the boxplot
boxplot(outlier_example)

# See if there are values > 8. See! There is one 180 
outlier_example[outlier_example > 8]

# At what index des it sit?
which(outlier_example > 8)

# Remove it form the dataset
oe <- outlier_example[-which(outlier_example>8)]
mean(oe)
median(oe)
sd(oe)
qplot(oe)
boxplot(oe)

```


# Select

dslab
```{r}
iris

# For the selection purpose just consider the first 10 records 
short_iris <- head(iris,10)

select(short_iris, starts_with("Petal"))
select(short_iris, starts_with("Sepal"))
select(short_iris, Species, everything())
select(short_iris, -Sepal.Length)
```

# Filter

```{r}
starwars
class(starwars)

# It works on a dataframe

filter(starwars, species == 'Human')
filter(starwars, mass > 100)
filter(starwars, species == 'Human', mass > 100)
filter(starwars, species == 'Human' & mass > 100)
filter(starwars, species == 'Human' | mass > 100)
filter(starwars, gender == 'female')

# It works just as well on a tibble

tib_starwars = as.tibble(starwars)
class(tib_starwars)
filter(tib_starwars, species == 'Human')
```

